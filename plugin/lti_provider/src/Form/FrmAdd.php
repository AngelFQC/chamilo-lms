<?php
/* For licensing terms, see /license.txt */

use Chamilo\PluginBundle\Entity\LtiProvider\Platform;

/**
 * Class FrmAdd.
 */
class FrmAdd extends FormValidator
{
    /**
     * @var Platform|null
     */
    private $platform;

    /**
     * FrmAdd constructor.
     *
     * @param string          $name
     * @param array           $attributes
     * @param Platform|null   $platform
     */
    public function __construct(
        $name,
        $attributes = [],
        Platform $platform = null
    ) {
        parent::__construct($name, 'POST', '', '', $attributes, self::LAYOUT_HORIZONTAL, true);

        $this->platform = $platform;
    }

    /**
     * Build the form
     */
    public function build()
    {
        $plugin = LtiProviderPlugin::create();

        $this->addHeader($plugin->get_lang('ConnectionDetails'));

        $this->addText('issuer', $plugin->get_lang('PlatformName'));
        $this->addUrl('auth_login_url', $plugin->get_lang('auth_login_url'));
        $this->addUrl('auth_token_url', $plugin->get_lang('auth_token_url'));
        $this->addUrl('key_set_url', $plugin->get_lang('key_set_url'));
        $this->addText('client_id', $plugin->get_lang('client_id'));
        $this->addText('deployment_id', $plugin->get_lang('deployment_id'));
        $this->addText('kid', $plugin->get_lang('kid'));

        $this->addButtonCreate($plugin->get_lang('AddPlatform'));
        $this->applyFilter('__ALL__', 'trim');

    }

    public function setDefaultValues()
    {
        $defaults = [];

        if (!$this->platform) {
            $this->platform = new Platform();
        }

        $defaults['issuer'] =  $this->platform->getIssuer();
        $defaults['auth_login_url'] = $this->platform->getAuthLoginUrl();
        $defaults['auth_token_url'] = $this->platform->getAuthTokenUrl();
        $defaults['key_set_url'] = $this->platform->getKeySetUrl();
        $defaults['client_id'] = $this->platform->getClientId();
        $defaults['deployment_id'] = $this->platform->getDeploymentId();
        $defaults['kid'] = $this->platform->getKid();

        $this->setDefaults($defaults);
    }

    public function returnForm()
    {
        $js = "<script>
            </script>";

        return $js.parent::returnForm(); // TODO: Change the autogenerated stub
    }
}
